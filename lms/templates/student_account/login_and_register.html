<%!
import json
from django.utils.translation import ugettext as _
from openedx.core.djangolib.js_utils import dump_js_escaped_json
%>
<%namespace name='static' file='/static_content.html'/>

<%inherit file="../main.html" />

<%block name="pagetitle">${_("Sign in or Register")}</%block>

<%block name="js_extra">
<%static:require_module module_name="js/student_account/logistration_factory" class_name="LogistrationFactory">
var options = ${data | n, dump_js_escaped_json};
LogistrationFactory(options);
if ('newrelic' in window) {
newrelic.finished();
// Because of a New Relic bug, the finished() event doesn't show up
// in Insights, so we have to make a new PageAction that is basically
// the same thing. We still want newrelic.finished() for session
// traces though.
newrelic.addPageAction('xfinished');
}
</%static:require_module>
</%block>

<%block name="header_extras">
% for template_name in ["account", "access", "form_field", "login", "register", "institution_login", "institution_register", "password_reset", "hinted_login"]:
<script type="text/template" id="${template_name}-tpl">
    <%static:include path="student_account/${template_name}.underscore" />
</script>
% endfor
</%block>

<div class="section-bkg-wrapper">
    <main id="main" aria-label="Content" tabindex="-1">
        <div id="login-and-registration-container" class="login-register" />
    </main>
</div>

<style>

    #register-point_of_contact {
        display: none !important;
    }
    .form-field.select-point_of_contact, .form-field.email-admin_email {
        display: none;
    }

    .selectbox {
        display: inline-block;
        cursor: pointer;
        position: relative;
        padding-left: 15px;
        margin-right: 15px;
    }

    .selectbox:before {
        content: '';
        width: 8px;
        height: 8px;
        background: #fff;
        border: 1px solid #000;
        border-radius: 50%;
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        margin: auto;
    }

    .selectbox.active {
    }

    .selectbox.active:after {
        content: '';
        width: 4px;
        height: 4px;
        left: 3px;
        border: none;
        background: red;
        position: absolute;
        border-radius: 50%;
        top: 0;
        bottom: 0;
        margin: auto;
        z-index: 111;
    }




</style>
<link rel="stylesheet" href="http://code.jquery.com/ui/1.8.18/themes/base/jquery-ui.css" type="text/css" media="all" />
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript">
</script> <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js" type="text/javascript"></script>
<script>


    $(document).ready(function () {
        $.ajax({
            url: "/organizations", success: function (result) {
                full_result = result
                orgs = Object.keys(result)
            }
        });

        setTimeout(function () {
            $("#register-organization").autocomplete({
                source: orgs, minLength: 3
            });

            $("#register-point_of_contact option").each(function() {
                // Get values of all option
                var val = $(this).val();
                var text = $(this).text();

                // Do magic create boxes like checkbox
                $(".select-point_of_contact").append('<div class="selectbox" data-value="' + val + '"> ' +  text + '</div>');

            });
            // Remove empty selectbox
            $('.selectbox[data-value=""]').remove();
            $('.selectbox:nth-child(2)').addClass('active');

            // Change select box on click
            $(".selectbox").click(function(e) {
                // Remove selected from others
                $(".selectbox").removeClass("active");
                // Do active to selected
                $(this).addClass("active");
                // Get value
                var optVal = $(this).data("value");
                $("#register-point_of_contact").val(optVal + "")
                if(optVal){
                    $(".form-field.email-admin_email").hide()
                } else {
                    $(".form-field.email-admin_email").show()
                }

            });

            // Change select box on dropdown change
            $("#register-point_of_contact").change(function() {
                var optVal = $(this).val();
                $(".selectbox").removeClass("active");
                $(".selectbox[data-value='" + optVal + "']").addClass("active");
            });

            // Passwords should match.
            $('#register-password, #register-confirm_password').on('keyup', function () {
                if ($('#register-password').val() == $('#register-confirm_password').val()) {
                    $('.note').html('* Required field');
                    $('.action.action-primary.action-update.js-register.register-button').prop('disabled', false);
                } else {
                    $('.note').html('* Required field, Password does not match.');
                    $('.action.action-primary.action-update.js-register.register-button').prop('disabled', true);
                }
            });

            $("#register-organization").focusout(function () {

                if ($("#register-organization").val()) {
                    if (orgs.includes($("#register-organization").val()) && full_result[$("#register-organization").val()]) {
                        $(".form-field.select-point_of_contact").hide();
                        $(".form-field.email-admin_email").hide()
                    } else {
                        $(".form-field.select-point_of_contact").show();
                    }
                } else {
                    $(".form-field.select-point_of_contact").hide();
                    $(".form-field.email-admin_email").hide()
                }
            });
        }, 3000);

    });


</script>


